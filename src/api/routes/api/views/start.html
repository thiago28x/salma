<!DOCTYPE html>
<html>
	<head>
		<title>Zaploop V2</title>
		<link
			rel="icon"
			type="image/png"
			href="https://d1muf25xaso8hp.cloudfront.net/https%3A%2F%2Fs3.amazonaws.com%2Fappforest_uf%2Ff1665248210953x914159784268078200%2Fzaploop-transparente.png?w=48&h=48&auto=compress&dpr=1.25&fit=max" />
	</head>
	<body>
		<style>
			@import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap");

			.col {
				display: flex;
				flex-direction: column;
				justify-content: space-between;
				background-color: #363333;
				padding: 1rem;
				margin: 20px;
				align-items: center;
			}

			.row {
				display: flex;
				flex-direction: row;
				justify-content: space-between;
				background-color: #363333;
				padding: 1rem;
				align-items: center;
				border-radius: 10px;
			}

			a {
				margin-top: 20px;
			}

			a:hover {
				color: #5de2a8;
			}

			header {
				display: flex;
				flex-direction: row;
				justify-content: space-between;
				background-color: #2a2a2a;
				color: #fff;
				padding: 1rem;
				width: 100%;
				position: fixed;
				top: 0;
				left: 0;
				height: 70px;
			}

			h1 {
				font-family: "Montserrat", sans-serif;
				font-weight: 700;
				font-size: 40px;
				text-align: center;
				color: #5de2a8;
			}

			.msgCard {
				border-radius: 10px;
				font-family: "Montserrat", sans-serif;
				font-weight: 400;
				font-size: 16px;
				text-align: left;
				color: #5de2a8;
				padding: 10px;
				margin: 5px;
				background-color: #2d2d2d;
				display: flex;
				align-items: left;
				justify-content: left;
				flex-direction: column;
				width: fit-content;
			}

			body {
				font-family: Montserrat, sans-serif;
				background-color: #272727;
				margin: 0;
				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;
				padding: 50px;
			}

			.container {
				border-radius: 10px;
				max-width: 500px;
				padding-top: 0px;
				background-color: #333;
				width: 100%;
				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;
				border: 3px solid #5de2a8;
				margin: 10px;
			}

			.contact-card {
				border-radius: 10px;
				padding: 5px;
				background-color: #333;
				height: 40px;
				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;
				border: 1px solid #5de2a81e;
				margin: 3px;
				width: fit-content;
			}

			.contact-number {
				color: #fff;
			}

			#contact-list {
				border-radius: 10px;
				padding-top: 0px;
				background-color: #3b3b3b;
				width: 20%;
				height: 95%;
				display: flex;
				align-items: left;
				justify-content: center;
				flex-direction: column;
				border: 0px solid #5de2a8;
				margin: 10px;
				overflow: hidden;
				transition: height 0.2s ease-out;
				height: auto;
				overflow-y: scroll;
				min-width: 230px;
			}

			#message-list-list {
				border-radius: 10px;
				padding-top: 0px;
				background-color: #3b3b3b;
				width: 80%;
				height: 95%;
				display: flex;
				align-items: right;
				justify-content: center;
				flex-direction: column;
				border: 0px solid #5de2a8;
				margin: 10px;
				overflow: hidden;
				transition: height 0.2s ease-out;
				height: auto;
				overflow-y: scroll;
			}

			#chat-container {
				border-radius: 10px;
				background-color: #212121;
				width: 80%;
				height: 80%;
				display: flex;
				align-items: left;
				justify-content: space-between;
				flex-direction: row;
				border: 0px solid #5de2a8;
				margin: 10px;
				overflow: hidden;
				transition: height 0.2s ease-out;
			}

			input[type="email"],
			input[type="text"] {
				width: 250px;
				height: 30px;
				margin: 5px;
				padding: 10px;
				text-align: left;
				border: none;
				border-radius: 5px;
				background-color: #ffffff;
				font-size: 18px;
				box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
				height: 20px;
				margin: 5px;
			}

			button {
				width: 270px;
				height: 60px;
				margin: 10px;
				padding: 5px;
				border: none;
				border-radius: 5px;
				background-color: #5de2a8;
				color: #fff;
				font-size: 18px;
				font-weight: 700;
				box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
				cursor: pointer;
				height: 40px;
			}

			#test-btn,
			.blue-btn {
				background-color: #336ed4;
			}

			img {
				width: 250px;
				height: 250px;
				margin: 10px 0;
				background-color: #fff;
				border-radius: 5px;
				padding: 5px;
			}

			footer {
				background-color: #0e3d91;
				color: #fff;
				width: 100%;
				height: 70px;
				display: flex;
				align-items: left;
				flex-direction: column;
				justify-content: left;
				position: fixed;
				bottom: 0;
				padding: 20px;
			}

			a {
				color: #fff;
				text-decoration: none;
				margin-right: 10px;
			}

			#image-qr-code {
				height: 200px !important;
				width: 200px !important;
			}

			table {
				color: white;
				min-height: 200px !important;
				min-width: 200px;
			}

			footer a,
			footer p {
				font-family: Montserrat;
			}

			#footer-div {
				margin: 20px;
			}

			.collapsed {
				height: 0 !important;
				overflow: hidden;
				transition: height 0.2s ease-out;
			}

			#conversation tr {
				display: flex;
				flex-direction: column;
			}

			#conversation {
				color: white;
				min-height: 200px !important;
				min-width: 200px;
				display: flex;
				flex-direction: column;
				width: 100%;
			}

			#conversation td {
				background-color: #2d2d2d;
				border-radius: 10px;
				box-shadow: 0 3px 6px rgba(102, 66, 188, 0.16);
				color: #fff;
				padding: 10px;
				margin-bottom: 10px;
				display: table-cell !important;
				width: auto !important;
				min-width: 20px !important;
			}

			#conversation tr td {
				width: fit-content !important;
				min-width: 20px !important;
			}

			#message-list {
				height: 100%; /* set the height of the message list */
				overflow-y: scroll; /* make the message list vertically scrollable */
				width: 95%;
			}

			.sidebar {
				width: 200px;
				height: 100vh;
				background-color: #333;
				position: fixed;
				left: 0;
				top: 0;
				padding-top: 20px;
			}

			.sidebar ul {
				list-style-type: none;
				margin: 0;
				padding: 0;
			}

			.sidebar li {
				margin-bottom: 10px;
			}

			.sidebar li a {
				display: block;
				color: #fff;
				text-decoration: none;
				padding: 10px;
			}

			.bor {
				border: #5de2a828 2px solid;
				border-radius: 10px;
			}

			.blue {
				border: #2e44d4 0px solid;
			}

			.disabled {
				background-color: #58635e;
				color: rgb(212, 212, 212);
			}
		</style>

		<div class="row blue">
			<div class="col bor">
				<h1>Zaploop V2</h1>
				<input
					type="text"
					id="session-input"
					placeholder="Session" />
				<input
					type="text"
					id="webhook-input"
					placeholder="webhook (optional)" />

				<button
					class="disabled"
					id="startButton">
					Start
				</button>
				<button
				onclick="testMessage()"


					class="disabled"
					class="blue-btn"
					id="testButton">
					Test Message
				</button>

			</div>
			<img
				id="qrCodeImage"
				alt="QR Code"
				width="200px"
				src="https://i.pinimg.com/originals/e4/af/9f/e4af9f0025a8ce68bee2cf5a1360a501.gif"
				draggable="false"
				alt="qr-code" />
		</div>

		<a href="https://zaploop.bubbleapps.io/version-test?debug_mode=true"
			>Página de teste</a
		>
		<a href="https://bubble.io/page?type=page&name=index&id=zaploop&tab=tabs-1"
			>Editor Página de teste</a
		>
		<a
			href="https://bubble.io/plugin_editor?id=1632506962289x816209902385758200&tab=tabs-6"
			>API Calls</a
		>

		<script>
			//  v3
			console.info("v3");

			const startButton = document.getElementById("startButton");
			const testButton = document.getElementById("testButton");

			const qrCodeImage = document.getElementById("qrCodeImage");

			startButton.addEventListener("click", async () => {
				// Call the init function
				const key = document.getElementById("session-input").value;
				const webhookUrl = document.getElementById("webhook-input").value;

				console.log(`Starting session: ${key}`);
				console.log(`Webhook URL: ${webhookUrl}`);

				let urlbase = "http://api.zaploop.xyz:3333/";

				const initResponse = await fetch(
					`${urlbase}instance/init?webhook=true&key=${key}&token=123&webhookUrl=${webhookUrl}`
				);
				const initData = await initResponse.json();

				console.log("\n Initialization data: \n ", initData);

				// Call the qrbase64 function
				console.log(`\n Fetching QR code base64...  Session: \n ${key}`);

				const qrBase64Response = await fetch(
					`${urlbase}instance/qrbase64?key=${key}`
				);
				const qrBase64Data = await qrBase64Response.json();

				console.log(qrBase64Data.message);
				console.log("QR code data: \n \n", qrBase64Data.qrcode);
				console.log("data json: \n \n", qrBase64Data);

				// Set the QR code image source to the base64 data
				qrCodeImage.src = qrBase64Data.qrcode;

				// Redirect to the QR code page
				window.location.href = `http://66.94.98.174:3333/instance/qr?key=${key}`;

				console.log("QR code image updated.");
			});

		

			function testMessage() {
				const session = document.getElementById("session-input").value;
				console.log(`Session: ${session}`);

				const apiUrl =
					"http://api.zaploop.xyz:3333/message/text?key=" + session;

				const data = new URLSearchParams();
				data.append("id", "554891854014");
				data.append("message", "hello world");

				fetch(apiUrl, {
					method: "POST",
					headers: {
						"Content-Type": "application/x-www-form-urlencoded",
					},
					body: data,
				})
					.then((response) => response.json())
					.then((data) => {
						console.log("Response:", data);
						console.log("Response:", data.data.id);
						alert("Message sent ✅ \nCheck your phone \nMessage ID:  \r\n" + data.data.id);
					})
					.catch((error) => {
						console.error("Error:", error);
					});
			}

			//ativar botões apos preencher input
			const sessionInput = document.getElementById("session-input");
			sessionInput.addEventListener("input", () => {
				if (sessionInput.value.trim() !== "") {
					startButton.classList.remove("disabled");
					testButton.classList.remove("disabled");
					testButton.classList.add("blue-btn");
				} else {
					startButton.classList.add("disabled");
					testButton.classList.add("disabled");
				}
			});
		</script>
	</body>
</html>
